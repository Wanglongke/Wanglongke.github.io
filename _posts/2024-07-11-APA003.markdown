---
layout: post
title:  APA-二进制科学计数
date:   2024-07-11 17:30:00 +0300
tags:   ArbitraryPrecisionArthmetic
description:  高精度计算
---

# [二进制科学计数](#二进制科学计数)

一个正数的二进制科学计数(Binary Scientific Numbers)表示为下面形式:   

$$r=1.c*2^{p}=(1+\sum_{i=0}^{n-1}c_{i}2^{-(i+1)})2^{p}$$   

其中$c=c0...c_{n-1}$有n位, $p$是整数。如果$c$有$\infty$位，则$r$可表示所有正实数。但是计算机里只能是有限位。   
有理数  
  
$$\frac{54}{4}=1.275*10^{1}=1.10011*2^{3}$$  
  
可以用有限位表示     
无理数$\sqrt{2}$则需要无穷位表示。   
可以使用$\sigma \in {-1,0,1}$表示符号。把具有这种形式$\sigma(1.c) * 2^{p}$表示的数的集合$B$称为二进制科学计数。   
      
$$x,y \in B, x+y, x-y, x*y  \in B$$    
   
但是除法是不包含的。因为除法会产生无穷位的表示。例如:    

$$1=1.0*2^{0}, 3=1.1*2^{1}$$     
    
但是$1/3$需要无穷位表示。     

二进制科学计数的具体实现：   
    
$$r=1.c*2^{p}$$    
    
其中$c$有$n$位，$c_{0},...c_{n-1}$, 其中最后一位为$c_{n-1}=1$     
其可改写为：   
    
$$r=\tilde{c}*2^{p-n}=\tilde{c}*2^{b}$$    
    
其中$\tilde{c}$ 是$(n+1)$位整数， 其首位与尾位都是1   
那么$r$可表示为：符号$\sigma$, $n+1$位整数$\tilde{c}$, 指数$b$   
那么二进制科学计数的加，减，乘可以表示为正整数的运算

## [乘法](乘法)

设  
$$x=1.u*2^{p},y=1.v*2^{q}, z=1.w*2^{r}$$    
如果$u=0$, 则   
$$x*y=1.v*2^{p+q}$$      

如果$v=0$, 则      
$$x*y=1.u*2^{p+q}$$          

如果$u>0, v>0$， $u$有$n>0$位， $v$有$m>0$位，则:   
$$x*y=1.u*2^{p}*1.v*2^{q}=\tilde{u}*2^{p-n}*\tilde{v}*2^{q-m}=\tilde{u}*\tilde{v}*2^{p-n+q-m}=\tilde{w}*2^{p-n+q-m}$$  

其中  
$$\tilde{w}=\tilde{u}*\tilde{v}$$   

是奇数乘积（$u$和$v$的最后一位都是1）。$\tilde{u}$有$n+1$位，$\tilde{v}$有$m+1$位，所以$\tilde{w}$是一个奇数，其有$n+m+1$或$n+m+2$位。   
  
**例如**：
```
n=4
m=3
smallest odd integers: 10001*1001 = 10011001  -->  n+m+1=8
largest odd integers:  11111*1111 = 111010001 -->  n+m+2=9
```
令$l=n+m+c$ 其中$c=0,or,c=1$    
则$\tilde{w}$是一个$(l+1)$位的奇数，  

$$\tilde{w}=1w_{0}...w_{l-1}=1.w_{0}...w_{l-1}*2^{l}=1.w*2^{l}, w_{l-1}=1$$   
    
$$x*y=\tilde{w}*2^{p-n+q-m}=1.w*2^{p-n+q-m+l}=1.w*2^{p+q+c}=1.w*2^{r}=z$$   
其中$r=p+q+c$

## [加法](加法)

设   
$$x=1.u*2^{p},y=1.v*2^{q}, z=1.w*2^{r}$$   
其中我们需要确定$w$和$r$. 
当$x=0$或$y=0$, 计算就十分简单。   
当$x>0$且$y>0$, 其中$u$具有$n$位，其中$v$具有$m$位，它们的和为：  

$$x+y=1.u*2^{p}+1.v*2^{q}=\tilde{u}*2^{p-n}+\tilde{v}*2^{q-m}$$   

此时计算取决于$p-n$和$q-m$的相对大小    

### [Case0](Case0)

当$p-n>q-m$，求和可以写成     

$$\tilde{u}*2^{p-n} + \tilde{v}*2^{q-m} = (\tilde{u}*2^{d}+\tilde{v}) *2^{q-m}= \tilde{w}*2^{q-m}$$   

其中$d=(p-n)-(q-m)$.      
整数$\tilde{u}*2^{d}$ 是偶数，因为$\tilde{u}$是奇数且$d>0$. 整数$\tilde{v}$是奇数. 因此$\tilde{w}$是奇数。

$$x+y=\tilde{w}*2^{q-m}=1.w*2^{q-m+l}=1.w*2^{r}=z$$   

其中$r=q-m+l$, 其中$l$是$\tilde{w}$首1-bit的位置(索引)。 这个加法的实现包含计算$\tilde{u}*2^{d}$, 其用**位左移**运算实现。然后加上$\tilde{v}$，然后就可以确定$\tilde{w}$的首1-bit位置了。


### [Case1](Case1)

当$p-n<q-m$，求和可以写成：      

$$\tilde{u}*2^{p-n} + \tilde{v}*2^{q-m} = (\tilde{u}+\tilde{v}*2^{d}) *2^{p-n}= \tilde{w}*2^{p-n}$$   

其中$d=(q-m)-(p-n)$.    
整数$\tilde{v}*2^{d}$是偶数因为$\tilde{v}$是奇数且$d>0$. 整数$\tilde{u}$是奇数. 因此$\tilde{w}$是奇数。     

$$x+y=\tilde{w}*2^{p-n}=1.w*2^{p-n+l}=1.w*2^{r}=z$$

其中$r=p-n+l$, 其中$l$是$\tilde{w}$首1-bit的位置(索引)。这个加法的实现包含计算$\tilde{v}*2^{d}$, 其用**位左移**运算实现。然后加上$\tilde{u}$，然后就可以确定$\tilde{w}$的首1-bit位置了。


### [Case2](Case2)

当$p-n=q-m$，求和可以写成:    

$$\tilde{u}*2^{p-n} + \tilde{v}*2^{q-m} = (\tilde{u}+\tilde{v}) *2^{q-m}= \tilde{w}*2^{q-m}$$   

整数$\tilde{u}$和$\tilde{v}$是奇数，因此$\tilde{w}$是偶数. 设$l$是$\tilde{w}$首1-bit的位置(索引)，设t是$\tilde{w}$尾1-bit的位置。其中需要$l>=t>0$，可以对$\tilde{w}$位右移$t$位获得一个奇数$\hat{w}$, 此时$\hat{w}$首1-bit的位置(索引)$f=l-t$:     

$$x+y=\tilde{w}*2^{q-m}=\hat{w}*2^{q-m+t}=1.w*2^{q-m+t+f}=1.w*2^{q-m+l}=1.w*2^{r}=z$$

其中$r=q-m+l$。小数部分$w$(表示为整数)有$l-t$位，加法的实现涉及整数加法$\tilde{w}=\tilde{u}+\tilde{v}$，然后确定$l$和$t$，$\tilde{w}$位右移$t$位获得$\hat{w}$, 最终得到$z=1.w*2^{r}$，无符号整数$\hat{w}$和指数$b=q-m+t$.



